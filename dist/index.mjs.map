{"version":3,"file":"index.mjs","sources":["../src/errors.js","../src/util.js","../src/indexes.js","../src/datastore.js","../src/index.js"],"sourcesContent":["'use strict'\n\nexport class DatastoreError extends Error {\n  constructor (message) {\n    super(message)\n    this.name = this.constructor.name\n    Error.captureStackTrace(this, this.constructor)\n  }\n}\n\nexport class KeyViolation extends DatastoreError {\n  constructor (doc, fieldName) {\n    super('Key violation error')\n    this.fieldName = fieldName\n    this.record = doc\n  }\n}\n\nexport class NotExists extends DatastoreError {\n  constructor (doc) {\n    super('Record does not exist')\n    this.record = doc\n  }\n}\n","'use strict'\n\nexport function delve (obj, key) {\n  let p = 0\n  key = key.split('.')\n  while (obj && p < key.length) {\n    obj = obj[key[p++]]\n  }\n  return obj === undefined || p < key.length ? undefined : obj\n}\n\nfunction getRandomString (n) {\n  return Math.random()\n    .toString(16)\n    .slice(2, 2 + n)\n}\n\nexport function getRandomId () {\n  return `${getRandomString(6)}-${getRandomString(6)}`\n}\n\nexport function cleanObject (obj) {\n  return Object.entries(obj).reduce((o, [k, v]) => {\n    if (v !== undefined) o[k] = v\n    return o\n  }, {})\n}\n","'use strict'\n\nimport { KeyViolation } from './errors'\nimport { delve } from './util'\n\nexport default class Index {\n  static create (options) {\n    return options.unique ? new UniqueIndex(options) : new Index(options)\n  }\n\n  constructor (options) {\n    this.options = options\n    this._data = new Map()\n  }\n\n  find (value) {\n    const list = this._data.get(value)\n    return Promise.resolve(list || [])\n  }\n\n  findOne (value) {\n    const list = this._data.get(value)\n    return Promise.resolve(list ? list[0] : undefined)\n  }\n\n  getAll () {\n    return Promise.resolve(Array.from(this._data.entries()))\n  }\n\n  // INTERNAL API\n  _addLink (key, doc) {\n    let list = this._data.get(key)\n    if (!list) {\n      list = []\n      this._data.set(key, list)\n    }\n    if (list.indexOf(doc) === -1) list.push(doc)\n  }\n\n  _removeLink (key, doc) {\n    const list = this._data.get(key) || []\n    const index = list.indexOf(doc)\n    if (index === -1) return\n    list.splice(index, 1)\n    if (!list.length) this._data.delete(key)\n  }\n\n  _insertDoc (doc) {\n    let key = delve(doc, this.options.fieldName)\n    if (key == null && this.options.sparse) return\n    if (Array.isArray(key)) {\n      key.forEach(key => this._addLink(key, doc))\n    } else {\n      this._addLink(key, doc)\n    }\n  }\n\n  _deleteDoc (doc) {\n    let key = delve(doc, this.options.fieldName)\n    if (Array.isArray(key)) {\n      key.forEach(key => this._removeLink(key, doc))\n    } else {\n      this._removeLink(key, doc)\n    }\n  }\n}\n\nclass UniqueIndex extends Index {\n  find (value) {\n    return Promise.resolve(this._data.get(value))\n  }\n\n  findOne (value) {\n    return Promise.resolve(this._data.get(value))\n  }\n\n  _addLink (key, doc) {\n    if (this._data.has(key)) {\n      throw new KeyViolation(doc, this.options.fieldName)\n    }\n    this._data.set(key, doc)\n  }\n\n  _removeLink (key, doc) {\n    this._data.delete(key)\n  }\n}\n","'use strict'\n\nimport fs from 'fs'\nimport { promisify } from 'util'\nimport Index from './indexes'\nimport pqueue from 'pqueue'\nimport trigger from 'trigger'\nimport { NotExists } from './errors'\nimport { getRandomId, cleanObject } from './util'\n\nconst readFile = promisify(fs.readFile)\nconst appendFile = promisify(fs.appendFile)\nconst openFile = promisify(fs.open)\nconst writeFile = promisify(fs.writeFile)\nconst syncFile = promisify(fs.fsync)\nconst closeFile = promisify(fs.close)\nconst renameFile = promisify(fs.rename)\n\nexport default class Datastore {\n  constructor (options) {\n    if (typeof options === 'string') options = { filename: options }\n    this.options = {\n      serialize: JSON.stringify,\n      deserialize: JSON.parse,\n      special: {\n        deleted: '$$deleted',\n        addIndex: '$$addIndex',\n        deleteIndex: '$$deleteIndex'\n      },\n      ...options\n    }\n    this.indexes = {\n      _id: Index.create({ fieldName: '_id', unique: true })\n    }\n    this._loaded = trigger()\n    this._queue = pqueue()\n    this._queue.push(() => this._loaded)\n    this.loaded = false\n    if (options.autoload) this.load()\n  }\n\n  async load () {\n    // if loading/loaded already, return the loaded promise\n    if (this.loaded) return this._loaded\n    await this._hydrate()\n    return this.compact()\n  }\n\n  compact () {\n    return this._execute(() => this._rewrite())\n  }\n\n  getAll () {\n    return this._execute(() => this._getAll())\n  }\n\n  async insert (doc) {\n    return this._execute(async () => {\n      doc = this._upsertDoc(doc)\n      await this._append(doc)\n      return doc\n    })\n  }\n\n  async update (doc) {\n    return this._execute(async () => {\n      doc = this._upsertDoc(doc, { mustExist: true })\n      await this._append(doc)\n      return doc\n    })\n  }\n\n  async delete (doc) {\n    const { deleted } = this.options.special\n    return this._execute(async () => {\n      doc = this._deleteDoc(doc)\n      await this._append({ [deleted]: doc })\n      return doc\n    })\n  }\n\n  async ensureIndex (options) {\n    const { fieldName } = options\n    const { addIndex } = this.options.special\n    if (this.indexes[fieldName]) return\n    return this._execute(() => {\n      this._addIndex(options)\n      return this._append({ [addIndex]: options })\n    })\n  }\n\n  async deleteIndex (fieldName) {\n    if (fieldName === '_id') return\n    const { deleteIndex } = this.options.special\n    return this._execute(() => {\n      this._deleteIndex(fieldName)\n      return this._append({ [deleteIndex]: { fieldName } })\n    })\n  }\n\n  setAutoCompaction (interval) {\n    this.stopAutoCompaction()\n    this.autoCompaction = setInterval(() => this.compact(), interval)\n  }\n\n  stopAutoCompaction () {\n    if (!this.autoCompaction) return\n    clearInterval(this.autoCompaction)\n    this.autoCompaction = undefined\n  }\n\n  // PRIVATE API\n\n  _execute (fn) {\n    return this._queue.push(fn)\n  }\n\n  _hydrate () {\n    this.loaded = true\n\n    const {\n      filename,\n      deserialize,\n      special: { deleted, addIndex, deleteIndex }\n    } = this.options\n\n    return (\n      readFile(filename, { encoding: 'utf8', flag: 'a+' })\n        .then(data => {\n          for (const line of data.split(/\\n/).filter(Boolean)) {\n            let doc = deserialize(line)\n            if (addIndex in doc) {\n              this._addIndex(doc[addIndex])\n            } else if (deleteIndex in doc) {\n              this._deleteIndex(doc[deleteIndex].fieldName)\n            } else if (deleted in doc) {\n              this._deleteDoc(doc[deleted])\n            } else {\n              this._upsertDoc(doc)\n            }\n          }\n        })\n        // fire the loaded trigger, releasing any DB requests\n        .then(() => this._loaded.fire())\n    )\n  }\n\n  _getAll () {\n    return Array.from(this.indexes._id._data.values())\n  }\n\n  _addIndex (options) {\n    const { fieldName } = options\n    const ix = Index.create(options)\n    this._getAll().forEach(doc => ix._insertDoc(doc))\n    this.indexes[fieldName] = ix\n  }\n\n  _deleteIndex (fieldName) {\n    delete this.indexes[fieldName]\n  }\n\n  _upsertDoc (doc, { mustExist = false } = {}) {\n    const olddoc = this.indexes._id._data.get(doc._id)\n    if (!olddoc && mustExist) throw new NotExists(doc)\n    doc = cleanObject(doc)\n    if (doc._id == null) doc = { _id: getRandomId(), ...doc }\n    const ixs = Object.values(this.indexes)\n    try {\n      ixs.forEach(ix => {\n        if (olddoc) ix._deleteDoc(olddoc)\n        ix._insertDoc(doc)\n      })\n      return doc\n    } catch (err) {\n      ixs.forEach(ix => {\n        ix._deleteDoc(doc)\n        if (olddoc) {\n          ix._deleteDoc(olddoc)\n          ix._insertDoc(olddoc)\n        }\n      })\n      throw err\n    }\n  }\n\n  _deleteDoc (doc) {\n    const ixs = Object.values(this.indexes)\n    const olddoc = this.indexes._id._data.get(doc._id)\n    if (!olddoc) throw new NotExists(doc)\n    ixs.forEach(ix => ix._deleteDoc(olddoc))\n    return olddoc\n  }\n\n  async _append (doc) {\n    const { filename, serialize } = this.options\n    const line = serialize(doc) + '\\n'\n    await appendFile(filename, line, 'utf8')\n  }\n\n  async _rewrite (doc) {\n    const {\n      filename,\n      serialize,\n      special: { addIndex }\n    } = this.options\n    const temp = filename + '~'\n    const lines = Array.from(this._getAll()).map(doc => serialize(doc) + '\\n')\n    const indexes = Object.values(this.indexes)\n      .filter(ix => ix.options.fieldName !== '_id')\n      .map(ix => ({ [addIndex]: ix.options }))\n      .map(doc => serialize(doc) + '\\n')\n    lines.push(...indexes)\n    const fh = await openFile(temp, 'w')\n    await writeFile(fh, lines.join(''), 'utf8')\n    await syncFile(fh)\n    await closeFile(fh)\n    await renameFile(temp, filename)\n  }\n}\n","'use strict'\n\nimport Datastore from './datastore'\nimport { KeyViolation, NotExists } from './errors'\n\nObject.assign(Datastore, { KeyViolation, NotExists })\nexport default Datastore\n"],"names":[],"mappings":"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"}